jQuery(document).ready(function(){function media_upload(button_class){var _custom_media=true,_orig_send_attachment=wp.media.editor.send.attachment;jQuery('body').on('click',button_class,function(e){var button_id='#'+jQuery(this).attr('id');var self=jQuery(button_id);var send_attachment_bkp=wp.media.editor.send.attachment;var button=jQuery(button_id);var id=button.attr('id').replace('_button','');_custom_media=true;wp.media.editor.send.attachment=function(props,attachment){if(_custom_media){jQuery('.'+button.attr('id')+'_id').val(attachment.id);jQuery('.'+button.attr('id')+'_img').attr('src',attachment.url).css('display','block');}else{ return _orig_send_attachment.apply(button_id,[props,attachment]);}};wp.media.editor.open(button);return true;});jQuery('.remove').click(function(e){jQuery("." + e.currentTarget.id + "_id").val(''); jQuery("." + e.currentTarget.id + "_img").attr('src',"");});}media_upload( '.custom_media_upload');function find_and_apply($widget){$widget.find('.bw-color-picker').wpColorPicker({change: _.throttle(function(){jQuery(this).trigger('change');},3000)});}jQuery(document).on('widget-added widget-updated',function(eve,widget){find_and_apply(widget);});jQuery('.widget:has(.bw-color-picker)').each(function(){find_and_apply(jQuery(this));});jQuery('.bw-change-color').click(function(){jQuery(this).parent().parent().find('.bw-color-picker').val(jQuery(this).attr('data-bw-color')).trigger('change');});});